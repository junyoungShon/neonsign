<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<resultMap type="mainArticleVO" id="mainArticleResultMap">
		<result property="mainArticleNo" column="MAIN_ARTICLE_NO" />
		<result property="mainArticleTitle" column="MAIN_ARTICLE_TITLE" />
		<result property="mainArticleContent" column="MAIN_ARTICLE_CONTENT" />
		<result property="mainArticleHIt" column="MAIN_ARTICLE_HIT" />
		<result property="mainArticleLike" column="MAIN_ARTICLE_LIKE" />
		<result property="mainArticleTotalLike" column="MAIN_ARTICLE_TOTAL_LIKE" />
		<result property="mainArticleDate" column="MAIN_ARTICLE_DATE" />
		<result property="mainArticleCompleteDate" column="MAIN_ARTICLE_COMPLETE_DATE" />
		<result property="memberEmail" column="MEMBER_EMAIL"/>
		<collection property="memberVO" column="MEMBER_EMAIL"
			ofType="memberVO" javaType="memberVO" resultMap="memberResultMap" />
		<collection property="subArticleList" column="MAIN_ARTICLE_NO"
			ofType="subArticleVO" javaType="ArrayList" resultMap="subArticleResultMap" />
	</resultMap>

	<resultMap type="subArticleVO" id="subArticleResultMap">
		<result property="subArticleNo" column="SUB_ARTICLE_NO" />
		<result property="mainArticle" column="MAIN_ARTICLE_NO" />
		<result property="memberEmail" column="MEMBER_EMAIL" />
		<result property="subAtricleGrade" column="SUB_ARTICLE_GRADE" />
		<result property="subArticleContent" column="SUB_ARTICLE_CONTENT" />
		<result property="isEnd" column="IS_END" />
		<result property="subArticleLike" column="SUBARTICLE_LIKE" />
		<result property="isConnect" column="IS_CONNECT" />
		<result property="subArticleDate" column="SUB_ARTICLE_DATE" />
		<collection property="memberVO" column="MEMBER_EMAIL"
			ofType="memberVO" javaType="memberVO" resultMap="memberResultMap" />
	</resultMap>

	<resultMap type="memberVO" id="memberResultMap">
		<result property="memberEmail" column="MEMBER_EMAIL" />
		<result property="memberNickName" column="MEMBER_NICKNAME" />
		<result property="memberPassword" column="MEMBER_PASSWORD" />
		<result property="memberJoinDate" column="MEMBER_JOIN_DATE" />
		<result property="memberPoint" column="MEMBER_POINT" />
		<result property="memberNotifiedAmount" column="MEMBER_NOTIFIED_AMOUNT" />
	</resultMap>
	<!-- tag_board ResultMap private String tagName; private int mainArticleNo; -->
	<resultMap type="tagBoardVO" id="tagBoardResultMap">
		<result property="tagName" column="TAG_NAME" />
		<result property="mainArticleNo" column="MAIN_ARTICLE_NO" />
	</resultMap>
	<!-- tagVO resultMap -->
	<resultMap type="tagVO" id="tagResultMap">
		<result property="tagName" column="TAG_NAME"/>
		<result property="searchCount" column="SEARCH_COUNT"/>
	</resultMap>
	<!-- 준영 -->
   <insert id="insertMainArticle" parameterType="mainArticleVO">
		<selectKey keyProperty="mainArticleNo" resultType="int" order="BEFORE">
			select main_article_seq.nextval from dual
		</selectKey>
		insert into main_article(MAIN_ARTICLE_NO,MAIN_ARTICLE_EMAIL,MAIN_ARTICLE_TITLE,MAIN_ARTICLE_CONTENT,MAIN_ARTICLE_DATE)
		values(#{mainArticleNo},#{memberEmail},#{mainArticleTitle},#{mainArticleContent},sysdate)
	</insert>
	<insert id="insertTagBoardVO" parameterType="tagBoardVO">
		insert into tag_board (tag_name,main_article_no) values (#{tagName},#{mainArticleNo})
	</insert>
   <!-- 글 작성 시 선택하는 태그가 인기 순으로 적용되기 위한 SQL -->
	<select id="selectListTagNameOrderBySearchCount" resultMap="tagResultMap">
		select tag_name,search_count from TAG order by search_count
	</select>
	<!-- 운택 -->
	<select id="selectOneCompleteMainArticleByMainArticleNo"
		parameterType="mainArticleVO" resultType="mainArticleVO" resultMap="mainArticleResultMap">
		select * from main_article m,sub_article s , brain_member b where
		m.MAIN_ARTICLE_NO=1 and b.MEMBER_EMAIL=m.MAIN_ARTICLE_EMAIL
	</select>
	<!-- 대협 -->

	<select id="completeMainArticleByMainArticleNo" resultType="mainArticleVO"
		resultMap="mainArticleResultMap">
		select m.MAIN_ARTICLE_NO, m.MAIN_ARTICLE_EMAIL,
		MAIN_ARTICLE_TITLE,
		MAIN_ARTICLE_CONTENT, MAIN_ARTICLE_HIT,
		MAIN_ARTICLE_LIKE,
		MAIN_ARTICLE_TOTAL_LIKE, MAIN_ARTICLE_DATE,
		MAIN_ARTICLE_COMPLETE_DATE
		from MAIN_ARTICLE m, SUB_ARTICLE s
		where
		m.MAIN_ARTICLE_NO =
		s.MAIN_ARTICLE_NO and s.IS_CONNECT=1 and s.IS_END=1
		and
		m.MAIN_ARTICLE_NO=#{value}
	</select>
	<select id="completeMainArticleOrderByDate" resultType="mainArticleVO"
		resultMap="mainArticleResultMap">
		select
		m.MAIN_ARTICLE_NO, m.MAIN_ARTICLE_EMAIL,
		MAIN_ARTICLE_TITLE,
		MAIN_ARTICLE_CONTENT, MAIN_ARTICLE_HIT,
		MAIN_ARTICLE_LIKE,
		MAIN_ARTICLE_TOTAL_LIKE, MAIN_ARTICLE_DATE,
		MAIN_ARTICLE_COMPLETE_DATE
		from MAIN_ARTICLE m, SUB_ARTICLE s
		where
		m.MAIN_ARTICLE_NO =
		s.MAIN_ARTICLE_NO and s.IS_CONNECT=1 and s.IS_END=1
		order by
		m.MAIN_ARTICLE_DATE desc
	</select>
	<select id="completeMainArticleOrderByTotalLike" resultType="mainArticleVO"
		resultMap="mainArticleResultMap">
		select MAIN_ARTICLE_NO, MAIN_ARTICLE_EMAIL,
		MAIN_ARTICLE_TITLE,
		MAIN_ARTICLE_CONTENT, MAIN_ARTICLE_HIT,
		MAIN_ARTICLE_LIKE,
		MAIN_ARTICLE_TOTAL_LIKE, MAIN_ARTICLE_DATE,
		MAIN_ARTICLE_UPDATE_DATE
		from MAIN_ARTICLE where MAIN_ARTICLE_COMPLETE = 1 order by MAIN_ARTICLE_UPDATE_DATE
	</select>
	<!-- 제성 -->
	<!-- 메인 새로운 주제글 최신순 List-->
	<select id="selectListNotCompleteMainArticleOrderByDate"
		resultMap="mainArticleResultMap">
	select ma.MAIN_ARTICLE_NO, ma.MAIN_ARTICLE_TITLE, ma.MAIN_ARTICLE_CONTENT, 
	ma.MAIN_ARTICLE_TOTAL_LIKE, to_char(ma.MAIN_ARTICLE_DATE, 'YYYY-MM-DD HH24:MI:SS') as ma_date, 
	ma.MAIN_ARTICLE_UPDATE_DATE, ma.MAIN_ARTICLE_COMPLETE, bm.MEMBER_NICKNAME
	from main_article ma, brain_member bm
	<![CDATA[where bm.MEMBER_EMAIL = ma.MAIN_ARTICLE_EMAIL and ma.MAIN_ARTICLE_COMPLETE=0 and 
	MAIN_ARTICLE_TOTAL_LIKE<10 order by ma_date desc]]> 
	</select>
	<!-- 메인 주제글 해당 tag list -->
	<select id="getMainArticleTagList" resultMap="tagBoardResultMap">
		select ma.MAIN_ARTICLE_NO, tb.TAG_NAME
		from main_article ma, tag_board tb
		where ma.MAIN_ARTICLE_NO = tb.MAIN_ARTICLE_NO and ma.MAIN_ARTICLE_NO=#{value}
	</select>
	<!-- 메인 베스트 주제글 최신순 List-->	
	<select id="getBestMainArticleVOListOrderByDate"
		resultMap="mainArticleResultMap">
	select ma.MAIN_ARTICLE_NO, ma.MAIN_ARTICLE_TITLE, ma.MAIN_ARTICLE_CONTENT, 
	ma.MAIN_ARTICLE_TOTAL_LIKE, to_char(ma.MAIN_ARTICLE_DATE, 'YYYY-MM-DD HH24:MI:SS') as ma_date, 
	ma.MAIN_ARTICLE_UPDATE_DATE, ma.MAIN_ARTICLE_COMPLETE, bm.MEMBER_NICKNAME
	from main_article ma, brain_member bm
	<![CDATA[where bm.MEMBER_EMAIL = ma.MAIN_ARTICLE_EMAIL and ma.MAIN_ARTICLE_COMPLETE=0 and 
	MAIN_ARTICLE_TOTAL_LIKE>9 order by ma_date desc]]> 
	</select>
	<!-- 전체 태그 불러오기 -->
	<select id="getTagVOList" resultMap="tagResultMap">
		select TAG_NAME from tag
	</select>
	
</mapper> 		
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















